!function(e){"use strict";window.GOVUK=window.GOVUK||{};var r='<section id="user-satisfaction-survey" class="visible" aria-hidden="false">  <div class="wrapper">    <h1>Tell us what you think of GOV.UK</h1>    <p class="right"><a href="#survey-no-thanks" id="survey-no-thanks">No thanks</a></p>    <p><a href="javascript:void()" id="take-survey" target="_blank" rel="noopener noreferrer">Take the 3 minute survey</a> This will open a short survey on another website</p>  </div></section>',a='<section id="user-satisfaction-survey" class="visible" aria-hidden="false">  <div id="email-survey-pre" class="wrapper">    <h1>Tell us what you think of GOV.UK</h1>    <p class="right"><a href="#survey-no-thanks" id="survey-no-thanks">No thanks</a></p>    <p><a href="#email-survey-form" id="email-survey-open" rel="noopener noreferrer">Your feedback will help us improve this website</a></p>  </div>  <form id="email-survey-form" action="/contact/govuk/email-survey-signup" method="post" class="wrapper js-hidden" aria-hidden="true">    <div id="feedback-prototype-form">      <h1>We\'d like to hear from you</h1>      <p class="right"><a href="#email-survey-cancel" id="email-survey-cancel">No thanks</a></p>      <label for="email">Tell us your email address and we\'ll send you a link to a quick feedback form.</label>      <input name="email_survey_signup[survey_id]" type="hidden" value="">      <input name="email_survey_signup[survey_source]" type="hidden" value="">      <input name="email_survey_signup[email_address]" type="text" placeholder="Your email address">      <div class="actions">        <button type="submit">Send</button>        <p class="button-info">We won\'t store your email address or share it with anyone</span>      </div>    </div>  </form>  <div id="email-survey-post-success" class="wrapper js-hidden" aria-hidden="true">    <p>Thanks, we\'ve sent you an email with a link to the survey.</p>  </div>  <div id="email-survey-post-failure" class="wrapper js-hidden" aria-hidden="true">    <p>Sorry, we\u2019re unable to send you an email right now.  Please try again later.</h2>  </div></section>',i={defaultSurvey:{url:"https://www.smartsurvey.co.uk/s/gov-uk",identifier:"user_satisfaction_survey",frequency:50,surveyType:"url"},smallSurveys:[],init:function(){var e=i.getActiveSurvey(i.defaultSurvey,i.smallSurveys);i.isSurveyToBeDisplayed(e)&&i.displaySurvey(e)},getActiveSurvey:function(r,a){var n=r;return e.each(a,function(e,r){i.currentTime()>=r.startTime&&i.currentTime()<=r.endTime&&("function"==typeof r.activeWhen?r.activeWhen()&&(n=r):n=r)}),n},displaySurvey:function(r){var a=e("#user-satisfaction-survey-container");if("email"===r.surveyType)i.displayEmailSurvey(r,a);else{if("url"!==r.surveyType&&void 0!==r.surveyType)return;i.displayURLSurvey(r,a)}i.trackEvent(r.identifier,"banner_shown","Banner has been shown")},displayURLSurvey:function(a,n){n.append(a.template||r);var t=e("#take-survey"),s=a.url;/smartsurvey/.test(s)&&-1===s.indexOf("?c=")&&(s+="?c="+i.currentPath()),t.attr("href",s),i.setURLSurveyEventHandlers(a)},displayEmailSurvey:function(r,n){n.append(r.template||a);var t=e('#email-survey-form input[name="email_survey_signup[survey_id]"]'),s=e('#email-survey-form input[name="email_survey_signup[survey_source]"]');t.val(r.identifier),s.val(i.currentPath()),i.setEmailSurveyEventHandlers(r)},setEmailSurveyEventHandlers:function(r){var a=e("#email-survey-open"),n=e("#email-survey-cancel"),t=e("#email-survey-pre"),s=e("#email-survey-form"),u=e("#email-survey-post-success"),o=e("#email-survey-post-failure"),l=e("#survey-no-thanks");l.click(function(e){return i.setSurveyTakenCookie(r),i.hideSurvey(r),i.trackEvent(r.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),a.click(function(e){return i.trackEvent(r.identifier,"email_survey_open","Email survey opened"),t.addClass("js-hidden").attr("aria-hidden","true"),s.removeClass("js-hidden").attr("aria-hidden","false"),e.stopPropagation(),!1}),n.click(function(e){return i.setSurveyTakenCookie(r),i.hideSurvey(r),i.trackEvent(r.identifier,"email_survey_cancel","Email survey cancelled"),e.stopPropagation(),!1}),s.submit(function(a){var n=function(){s.addClass("js-hidden").attr("aria-hidden","true"),u.removeClass("js-hidden").attr("aria-hidden","false"),i.setSurveyTakenCookie(r),i.trackEvent(r.identifier,"email_survey_taken","Email survey taken"),i.trackEvent(r.identifier,"banner_taken","User taken survey")},t=function(){s.addClass("js-hidden").attr("aria-hidden","true"),o.removeClass("js-hidden").attr("aria-hidden","false")},l=s.attr("action");return/\.js$/.test(l)||(l+=".js"),e.ajax({type:"POST",url:l,dataType:"json",data:s.serialize(),success:n,error:t,statusCode:{500:t}}),a.stopPropagation(),!1})},setURLSurveyEventHandlers:function(r){var a=e("#survey-no-thanks"),n=e("#take-survey");a.click(function(e){return i.setSurveyTakenCookie(r),i.hideSurvey(r),i.trackEvent(r.identifier,"banner_no_thanks","No thanks clicked"),e.stopPropagation(),!1}),n.click(function(){i.setSurveyTakenCookie(r),i.hideSurvey(r),i.trackEvent(r.identifier,"banner_taken","User taken survey")})},isSurveyToBeDisplayed:function(r){return i.pathInBlacklist()?!1:i.otherNotificationVisible()||"true"===GOVUK.cookie(i.surveyTakenCookieName(r))?!1:i.userCompletedTransaction()?!1:e("#user-satisfaction-survey-container").length<=0?!1:i.randomNumberMatches(r.frequency)?!0:!1},pathInBlacklist:function(){var e=new RegExp("^/(?:"+/service-manual/.source+")(?:/|$)");return e.test(i.currentPath())},userCompletedTransaction:function(){function e(e,r){return e.indexOf(r)>-1}var r=i.currentPath();return e(r,"/done")||e(r,"/transaction-finished")||e(r,"/driving-transaction-finished")?!0:void 0},trackEvent:function(e,r,a){GOVUK.analytics.trackEvent(e,r,{label:a,value:1,nonInteraction:!0})},setSurveyTakenCookie:function(e){GOVUK.cookie(i.surveyTakenCookieName(e),!0,{days:120})},hideSurvey:function(r){e("#user-satisfaction-survey").removeClass("visible").attr("aria-hidden","true")},randomNumberMatches:function(e){return 0===Math.floor(Math.random()*e)},otherNotificationVisible:function(){var r=[".govuk-emergency-banner:visible","#global-cookie-message:visible","#global-browser-prompt:visible","#taxonomy-survey:visible"];return e(r.join(", ")).length>0},surveyTakenCookieName:function(e){var r="taken_"+e.identifier,a=r.replace(/(\_\w)/g,function(e){return e.charAt(1).toUpperCase()});return"govuk_"+a},currentTime:function(){return(new Date).getTime()},currentPath:function(){return window.location.pathname}};GOVUK.userSurveys=i,e(document).ready(function(){GOVUK.userSurveys&&GOVUK.userSurveys.init()})}(jQuery);